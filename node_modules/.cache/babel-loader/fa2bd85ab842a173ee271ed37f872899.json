{"ast":null,"code":"var _jsxFileName = \"/Users/miczero/ParaAsset/src/views/Bond/Bond.tsx\";\nimport React, { useCallback, useMemo } from 'react';\nimport { Route, Switch, useRouteMatch } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useWallet } from 'use-wallet';\nimport useIsMobile from '../../hooks/useIsMobile';\nimport Button from '../../components/Button';\nimport Page from '../../components/Page';\nimport PageHeader from '../../components/PageHeader';\nimport ExchangeCard from './components/ExchangeCard';\nimport styled from 'styled-components';\nimport Spacer from '../../components/Spacer';\nimport useBondStats from '../../hooks/useBondStats';\nimport useBasisCash from '../../hooks/useBasisCash';\nimport useBondOraclePriceInLastTWAP from '../../hooks/useBondOraclePriceInLastTWAP';\nimport { useTransactionAdder } from '../../state/transactions/hooks';\nimport config from '../../config';\nimport bond from '../../assets/img/bond.png';\nimport LaunchCountdown from '../../components/LaunchCountdown';\nimport ExchangeStat from './components/ExchangeStat';\nimport useTokenBalance from '../../hooks/useTokenBalance';\nimport { getDisplayBalance } from '../../utils/formatBalance';\nimport { BOND_REDEEM_PRICE, BOND_REDEEM_PRICE_BN } from '../../basis-cash/constants';\n\nconst Bond = () => {\n  const {\n    path\n  } = useRouteMatch();\n  const {\n    t\n  } = useTranslation();\n  const {\n    account,\n    connect\n  } = useWallet();\n  const basisCash = useBasisCash();\n  const addTransaction = useTransactionAdder();\n  const bondStat = useBondStats();\n  const cashPrice = useBondOraclePriceInLastTWAP();\n  const isMobile = useIsMobile();\n  const bondBalance = useTokenBalance(basisCash === null || basisCash === void 0 ? void 0 : basisCash.GAB);\n  const handleBuyBonds = useCallback(async amount => {\n    const tx = await basisCash.buyBonds(amount);\n    const bondAmount = Number(amount) / Number(getDisplayBalance(cashPrice));\n    addTransaction(tx, {\n      summary: `Buy ${bondAmount.toFixed(2)} GAB with ${amount} GAC`\n    });\n  }, [basisCash, addTransaction, cashPrice]);\n  const handleRedeemBonds = useCallback(async amount => {\n    const tx = await basisCash.redeemBonds(amount);\n    addTransaction(tx, {\n      summary: `Redeem ${amount} GAB`\n    });\n  }, [basisCash, addTransaction]);\n  const isBondRedeemable = useMemo(() => cashPrice.gt(BOND_REDEEM_PRICE_BN), [cashPrice]);\n  const isBondPurchasable = useMemo(() => Number(bondStat === null || bondStat === void 0 ? void 0 : bondStat.priceInDAI) < 1.0, [bondStat]);\n  const isLaunched = Date.now() >= config.bondLaunchesAt.getTime();\n\n  if (!isLaunched) {\n    return /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Page, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(PageHeader, {\n      icon: /*#__PURE__*/React.createElement(\"img\", {\n        src: bond,\n        height: isMobile ? '66' : '133',\n        width: isMobile ? '88' : '176',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 15\n        }\n      }),\n      title: t('gmhshzq'),\n      subtitle: t('shskzqbf'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(Spacer, {\n      size: \"md\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(LaunchCountdown, {\n      deadline: config.bondLaunchesAt,\n      description: t('zqrhyz'),\n      descriptionLink: \"https://docs.basis.cash/mechanisms/stabilization-mechanism\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 11\n      }\n    })));\n  }\n\n  return /*#__PURE__*/React.createElement(Switch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Page, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, !!account ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Route, {\n    exact: true,\n    path: path,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(PageHeader, {\n    icon: /*#__PURE__*/React.createElement(\"img\", {\n      src: bond,\n      height: isMobile ? '66' : '133',\n      width: isMobile ? '88' : '176',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 19\n      }\n    }),\n    title: t('gmhshzq'),\n    subtitle: t('shskzqbf'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Spacer, {\n    size: \"md\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(StyledBond, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(StyledCardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ExchangeCard, {\n    action: t('caigou'),\n    fromToken: basisCash.GAC,\n    fromTokenName: t('bizhong'),\n    toToken: basisCash.GAB,\n    toTokenName: t('geazhaiquan'),\n    priceDesc: !isBondPurchasable ? t('baccg') : t('dgac', {\n      label: Math.floor(100 / Number(bondStat.priceInDAI) - 100)\n    }),\n    onExchange: handleBuyBonds,\n    disabled: !bondStat || isBondRedeemable,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(StyledStatsWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ExchangeStat, {\n    tokenName: \"GAC\",\n    description: t('zhykjg'),\n    price: getDisplayBalance(cashPrice, 18, 2),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Spacer, {\n    size: \"md\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(ExchangeStat, {\n    tokenName: \"GAB\",\n    description: t('dqgacjg'),\n    price: (bondStat === null || bondStat === void 0 ? void 0 : bondStat.priceInDAI) || '-',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(StyledCardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ExchangeCard, {\n    action: t('shuhui'),\n    fromToken: basisCash.GAB,\n    fromTokenName: t('geazhaiquan'),\n    toToken: basisCash.GAC,\n    toTokenName: t('bizhong'),\n    priceDesc: `${getDisplayBalance(bondBalance)} ${t('kygab')}`,\n    onExchange: handleRedeemBonds,\n    disabled: !bondStat || bondBalance.eq(0) || !isBondRedeemable,\n    disabledDescription: !isBondRedeemable ? t('agacsqy', {\n      label: BOND_REDEEM_PRICE\n    }) : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 17\n    }\n  })))) : /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      alignItems: 'center',\n      display: 'flex',\n      flex: 1,\n      justifyContent: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => connect('injected'),\n    text: t('jsqb'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }\n  }))));\n};\n\nconst StyledBond = styled.div`\n  display: flex;\n  width: 900px;\n  @media (max-width: 768px) {\n    width: 100%;\n    flex-flow: column nowrap;\n    align-items: center;\n  }\n`;\nconst StyledCardWrapper = styled.div`\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  @media (max-width: 768px) {\n    width: 80%;\n  }\n`;\nconst StyledStatsWrapper = styled.div`\n  display: flex;\n  flex: 0.8;\n  margin: 0 20px;\n  flex-direction: column;\n\n  @media (max-width: 768px) {\n    width: 80%;\n    margin: 16px 0;\n  }\n`;\nexport default Bond;","map":{"version":3,"sources":["/Users/miczero/ParaAsset/src/views/Bond/Bond.tsx"],"names":["React","useCallback","useMemo","Route","Switch","useRouteMatch","useTranslation","useWallet","useIsMobile","Button","Page","PageHeader","ExchangeCard","styled","Spacer","useBondStats","useBasisCash","useBondOraclePriceInLastTWAP","useTransactionAdder","config","bond","LaunchCountdown","ExchangeStat","useTokenBalance","getDisplayBalance","BOND_REDEEM_PRICE","BOND_REDEEM_PRICE_BN","Bond","path","t","account","connect","basisCash","addTransaction","bondStat","cashPrice","isMobile","bondBalance","GAB","handleBuyBonds","amount","tx","buyBonds","bondAmount","Number","summary","toFixed","handleRedeemBonds","redeemBonds","isBondRedeemable","gt","isBondPurchasable","priceInDAI","isLaunched","Date","now","bondLaunchesAt","getTime","GAC","label","Math","floor","eq","alignItems","display","flex","justifyContent","StyledBond","div","StyledCardWrapper","StyledStatsWrapper"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport { Route, Switch, useRouteMatch } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useWallet } from 'use-wallet';\nimport useIsMobile from '../../hooks/useIsMobile';\nimport Button from '../../components/Button';\nimport Page from '../../components/Page';\nimport PageHeader from '../../components/PageHeader';\nimport ExchangeCard from './components/ExchangeCard';\nimport styled from 'styled-components';\nimport Spacer from '../../components/Spacer';\nimport useBondStats from '../../hooks/useBondStats';\nimport useBasisCash from '../../hooks/useBasisCash';\nimport useBondOraclePriceInLastTWAP from '../../hooks/useBondOraclePriceInLastTWAP';\nimport { useTransactionAdder } from '../../state/transactions/hooks';\nimport config from '../../config';\nimport bond from '../../assets/img/bond.png';\nimport LaunchCountdown from '../../components/LaunchCountdown';\nimport ExchangeStat from './components/ExchangeStat';\nimport useTokenBalance from '../../hooks/useTokenBalance';\nimport { getDisplayBalance } from '../../utils/formatBalance';\nimport { BOND_REDEEM_PRICE, BOND_REDEEM_PRICE_BN } from '../../basis-cash/constants';\n\nconst Bond: React.FC = () => {\n  const { path } = useRouteMatch();\n  const { t } = useTranslation();\n  const { account, connect } = useWallet();\n  const basisCash = useBasisCash();\n  const addTransaction = useTransactionAdder();\n  const bondStat = useBondStats();\n  const cashPrice = useBondOraclePriceInLastTWAP();\n  const isMobile = useIsMobile();\n  const bondBalance = useTokenBalance(basisCash?.GAB);\n\n  const handleBuyBonds = useCallback(\n    async (amount: string) => {\n      const tx = await basisCash.buyBonds(amount);\n      const bondAmount = Number(amount) / Number(getDisplayBalance(cashPrice));\n      addTransaction(tx, {\n        summary: `Buy ${bondAmount.toFixed(2)} GAB with ${amount} GAC`,\n      });\n    },\n    [basisCash, addTransaction, cashPrice],\n  );\n\n  const handleRedeemBonds = useCallback(\n    async (amount: string) => {\n      const tx = await basisCash.redeemBonds(amount);\n      addTransaction(tx, { summary: `Redeem ${amount} GAB` });\n    },\n    [basisCash, addTransaction],\n  );\n  const isBondRedeemable = useMemo(() => cashPrice.gt(BOND_REDEEM_PRICE_BN), [cashPrice]);\n  const isBondPurchasable = useMemo(() => Number(bondStat?.priceInDAI) < 1.0, [bondStat]);\n\n  const isLaunched = Date.now() >= config.bondLaunchesAt.getTime();\n  if (!isLaunched) {\n    return (\n      <Switch>\n        <Page>\n          <PageHeader\n            icon={\n              <img\n                src={bond}\n                height={isMobile ? '66' : '133'}\n                width={isMobile ? '88' : '176'}\n              />\n            }\n            title={t('gmhshzq')}\n            subtitle={t('shskzqbf')}\n          />\n          <Spacer size=\"md\" />\n          <LaunchCountdown\n            deadline={config.bondLaunchesAt}\n            description={t('zqrhyz')}\n            descriptionLink=\"https://docs.basis.cash/mechanisms/stabilization-mechanism\"\n          />\n        </Page>\n      </Switch>\n    );\n  }\n  return (\n    <Switch>\n      <Page>\n        {!!account ? (\n          <>\n            <Route exact path={path}>\n              <PageHeader\n                icon={\n                  <img\n                    src={bond}\n                    height={isMobile ? '66' : '133'}\n                    width={isMobile ? '88' : '176'}\n                  />\n                }\n                title={t('gmhshzq')}\n                subtitle={t('shskzqbf')}\n              />\n            </Route>\n            <Spacer size=\"md\" />\n            <StyledBond>\n              <StyledCardWrapper>\n                <ExchangeCard\n                  action={t('caigou')}\n                  fromToken={basisCash.GAC}\n                  fromTokenName={t('bizhong')}\n                  toToken={basisCash.GAB}\n                  toTokenName={t('geazhaiquan')}\n                  priceDesc={\n                    !isBondPurchasable\n                      ? t('baccg')\n                      : t('dgac', {\n                          label: Math.floor(100 / Number(bondStat.priceInDAI) - 100),\n                        })\n                  }\n                  onExchange={handleBuyBonds}\n                  disabled={!bondStat || isBondRedeemable}\n                />\n              </StyledCardWrapper>\n              <StyledStatsWrapper>\n                <ExchangeStat\n                  tokenName=\"GAC\"\n                  description={t('zhykjg')}\n                  price={getDisplayBalance(cashPrice, 18, 2)}\n                />\n                <Spacer size=\"md\" />\n                <ExchangeStat\n                  tokenName=\"GAB\"\n                  description={t('dqgacjg')}\n                  price={bondStat?.priceInDAI || '-'}\n                />\n              </StyledStatsWrapper>\n              <StyledCardWrapper>\n                <ExchangeCard\n                  action={t('shuhui')}\n                  fromToken={basisCash.GAB}\n                  fromTokenName={t('geazhaiquan')}\n                  toToken={basisCash.GAC}\n                  toTokenName={t('bizhong')}\n                  priceDesc={`${getDisplayBalance(bondBalance)} ${t('kygab')}`}\n                  onExchange={handleRedeemBonds}\n                  disabled={!bondStat || bondBalance.eq(0) || !isBondRedeemable}\n                  disabledDescription={\n                    !isBondRedeemable\n                      ? t('agacsqy', {\n                          label: BOND_REDEEM_PRICE,\n                        })\n                      : null\n                  }\n                />\n              </StyledCardWrapper>\n            </StyledBond>\n          </>\n        ) : (\n          <div\n            style={{\n              alignItems: 'center',\n              display: 'flex',\n              flex: 1,\n              justifyContent: 'center',\n            }}\n          >\n            <Button onClick={() => connect('injected')} text={t('jsqb')} />\n          </div>\n        )}\n      </Page>\n    </Switch>\n  );\n};\n\nconst StyledBond = styled.div`\n  display: flex;\n  width: 900px;\n  @media (max-width: 768px) {\n    width: 100%;\n    flex-flow: column nowrap;\n    align-items: center;\n  }\n`;\n\nconst StyledCardWrapper = styled.div`\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  @media (max-width: 768px) {\n    width: 80%;\n  }\n`;\n\nconst StyledStatsWrapper = styled.div`\n  display: flex;\n  flex: 0.8;\n  margin: 0 20px;\n  flex-direction: column;\n\n  @media (max-width: 768px) {\n    width: 80%;\n    margin: 16px 0;\n  }\n`;\n\nexport default Bond;\n"]},"metadata":{},"sourceType":"module"}